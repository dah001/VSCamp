<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Login</title> 

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
body { font-family: Arial; background: #f4f6f8; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
#app { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); width: 350px; text-align: center; }
input { width: 100%; padding: 12px; margin-bottom: 15px; font-size: 16px; }
button { width: 100%; padding: 12px; background: #4A90E2; color: white; border: none; border-radius: 8px; cursor: pointer; }
.error { color: red; margin-top: 10px; }
.success { color: green; margin-top: 10px; }
</style>
</head>

<body>
<div id="app">
    <h2>Login</h2>

    <input type="text"
           placeholder="Skriv din @edu.zealand.dk mail"
           v-model="username" />

    <input v-if="isAdmin"
           type="password"
           placeholder="Admin password"
           v-model="password" />

    <button @click="login">Login</button>

    <div class="error" v-if="error">{{ error }}</div>
    <div class="success" v-if="success">{{ success }}</div>
</div>

<script>
const apiUrl = "https://localhost:7099/api/auth/login";

Vue.createApp({
    data() {
        return {
            username: "",
            password: "",
            error: null,
            success: null
        };
    },

    computed: {
        isAdmin() {
            return this.username.trim().toLowerCase() === "admin@edu.zealand.dk";
        }
    },

    methods: {
        login() {
            this.error = null;
            this.success = null;

            if (!this.username.trim()) {
                this.error = "Username mÃ¥ ikke vÃ¦re tom";
                return;
            }

            const payload = {
                Username: this.username.trim(),
                Password: this.isAdmin ? this.password : null
            };

     axios.post(apiUrl, payload, { withCredentials: true })
    .then(res => {
        const role = res.data.role;
        this.success = `Logget ind som ${role}`;

        // ðŸ”¹ Redirect direkte med location.assign
        if (role.toLowerCase() === "admin") {
            window.location.assign("issues.html");
        } else {
            window.location.assign("report.html");
        }
    })
    .catch(err => {
        this.error = err.response?.data || "Login fejlede";
    });
        }
    }
}).mount("#app");
</script>
</body>
</html>
